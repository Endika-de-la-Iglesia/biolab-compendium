(self.webpackChunkbiolab_compendium=self.webpackChunkbiolab_compendium||[]).push([[787],{5508:e=>{const t={development:{apiUrl:"http://localhost:8080",devServer:{host:"localhost",port:3e3}},production:prod,test:{apiUrl:"http://localhost:8081",devServer:{host:"localhost",port:3001}}};e.exports=t.production},4787:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ue});var n=a(6540),r=a(1468),o=a(7767),l=a(4976),c=a(1083),i=a(8028),s=a(5537);const m=a(5508),u=async()=>{const e=localStorage.getItem("authToken"),t=m.apiUrl;if(e)try{const a=(0,s.s)(e),n=Date.now()/1e3;if(a.exp<n)return localStorage.removeItem("authToken"),null;try{if((await c.A.get("".concat(t,"/api/auth/user/").concat(a.id))).data)return{userInfo:a,token:e}}catch(e){return localStorage.removeItem("authToken"),null}}catch(e){return localStorage.removeItem("authToken"),null}return null};var p=a(6784);function d(){const e=(0,r.wA)(),t=(0,o.Zp)(),{role:a,isAuthenticated:c}=(0,r.d4)((e=>e.auth)),s=e=>{let{isActive:t}=e;return t?"nav-link-active":"nav-link-inactive"};return n.createElement("div",{className:"navbar-wrapper"},n.createElement("div",{className:"logo"},n.createElement(l.N_,{to:"/"},n.createElement("img",{src:"/assets/images/logo.png",alt:"logo"}))),n.createElement("div",{className:"navlinks-wrapper"},n.createElement(l.k2,{to:"/",className:s},"Inicio"),n.createElement(l.k2,{to:"/protocols/all-categories",className:s},"Explora"),c?n.createElement(l.k2,{to:"/favourites/all-categories",className:s},"Favoritos"):null,"admin"===a&&c?n.createElement(l.k2,{to:"/users-management",className:s},"Usuarios"):null,c?n.createElement("div",{className:"logged-in-user"},n.createElement("div",{className:"user-icon"},n.createElement("div",{className:"activity-icon"},n.createElement(l.N_,{to:"/account-management"},n.createElement(p.g,{icon:"fa-user",size:"lg"})))),n.createElement("div",{className:"logout-icon",onClick:()=>{localStorage.removeItem("authToken"),e((0,i.ri)()),t("/")}},n.createElement("div",{className:"activity-icon"},n.createElement(p.g,{icon:"fa-right-from-bracket",size:"lg"})))):n.createElement("div",{className:"login-icon"},n.createElement(l.k2,{to:"/login",className:s},n.createElement("div",{className:"activity-icon"},n.createElement(p.g,{icon:"fa-right-to-bracket",size:"xl"}))))))}const v=e=>{let{onSearch:t}=e;const[a,r]=(0,n.useState)("");return n.createElement("div",{className:"search-bar-wrapper"},n.createElement("form",{className:"search-bar",onSubmit:e=>{e.preventDefault(),r(""),t(a)}},n.createElement("input",{type:"text",placeholder:"Escribir aquí términos de búsqueda",value:a,onChange:e=>r(e.target.value)}),n.createElement("button",{className:"btn",type:"submit"},"Buscar")))};function E(){return n.createElement("div",{className:"bottom-wrapper"},n.createElement("span",null,n.createElement("span",{className:"bold"},(new Date).getFullYear()," || "),"Endika de la Iglesia"))}function g(){const[e,t]=(0,n.useState)(!1);(0,n.useEffect)((()=>{const e=()=>{window.scrollY>40?t(!0):t(!1)};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[]);return n.createElement("div",null,e?n.createElement("button",{onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},style:{position:"fixed",bottom:"20px",right:"20px",backgroundColor:"#B25EF3",color:"#F9F3FE",border:"none",borderRadius:"50%",padding:"10px 15px",cursor:"pointer",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3}},"⇧"):null)}const f=function(){const e={"Biomoléculas-DNA":"/assets/images/adn.jpg","Biomoléculas-Proteínas":"/assets//images/proteína.jpg",Microbiología:"/assets/images/microbiología.jpg","Cultivos celulares":"/assets/images/célula_eucariota.jpg"},t=(0,o.Zp)();return n.createElement("div",{className:"home-wrapper"},n.createElement(g,null),n.createElement("div",{className:"home-top-wrapper"},n.createElement(d,null)),n.createElement("div",{className:"home-info-wrapper",style:{backgroundImage:'linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url("/assets/images/home-background.jpg")',backgroundSize:"cover",backgroundPosition:"center"}},n.createElement("p",null,"¡Bienvenido a BioLab Compendium! Aquí encontrarás una selección de protocolos de laboratorio. Prueba a buscar un término de interés o a explorar las diferentes categorías.")),n.createElement("div",{className:"home-search-featured-wrapper"},n.createElement(v,{onSearch:e=>{t("/protocols?search=".concat(e))}}),function(){const t=Object.entries(e).map((e=>{let[t,a]=e;return n.createElement("div",{className:"featured-category",key:t},n.createElement(l.N_,{to:{pathname:"/protocols/".concat(t)}},n.createElement("div",{className:"featured-category-img"},n.createElement("img",{src:a,alt:"Image for ".concat(t)})),n.createElement("div",{className:"featured-category-txt"},t)))}));return n.createElement("div",{className:"featured-categories-wrapper"},t)}()),n.createElement(E,null))};function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){y(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function y(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const _=a(5508),w=()=>{const e=(0,o.Zp)(),t=(0,r.wA)(),a=_.apiUrl,[l,m]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),v={Google:"gmail.com"},[f,b]=(0,n.useState)({email:"",password:""}),[y,w]=(0,n.useState)({username:"",email:"",password:"",company:"no"}),N=e=>e.split("@")[1]===v[y.company],k=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*?&¿!#^])[A-Za-z\d@$!%*?&¿!#^]{10,100}$/,O=e=>{const{name:t,value:a}=e.target;b(h(h({},f),{},{[t]:a}))},C=e=>{const{name:t,value:a}=e.target;w(h(h({},y),{},{[t]:a}))};return n.createElement("div",{className:"auth-page-wrapper"},n.createElement(g,null),n.createElement(d,null),n.createElement("div",{className:"auth-forms-wrapper"},n.createElement("div",{className:"login-form form"},n.createElement("h2",{className:"title"},"Inicio de sesión"),n.createElement("form",{onSubmit:async n=>{n.preventDefault();try{const n=(await c.A.post("".concat(a,"/api/auth/login"),f)).data;localStorage.setItem("authToken",n.token);const r=(0,s.s)(n.token);t((0,i.iA)({id:r.id,role:r.role,company:r.company,username:r.username,email:r.email,token:n.token})),e("/")}catch(e){e.response&&e.response.data&&e.response.data.error?alert("Error en el login: ".concat(e.response.data.error)):alert("Error en el login: ".concat(e.message))}}},n.createElement("input",{type:"email",name:"email",placeholder:"Email",value:f.email,onChange:O}),n.createElement("div",{className:"password-field"},n.createElement("input",{type:l?"text":"password",name:"password",placeholder:"Contraseña",value:f.password,onChange:O}),n.createElement("button",{className:"btn",type:"button",onClick:()=>{m(!l)}},l?"Ocultar contraseña":"Mostrar contraseña")),n.createElement("button",{className:"btn",type:"submit"},"Login"))),n.createElement("div",{className:"registration-form form"},n.createElement("h2",{className:"title"},"Registro de nuevos usuarios"),n.createElement("form",{onSubmit:async t=>{if(t.preventDefault(),"no"===y.company||N(y.email))try{await c.A.post("".concat(a,"/api/auth/register"),y);e("/email-sent",{state:{fromRegistration:!0}})}catch(e){e.response&&e.response.data&&e.response.data.error?alert("Error en el registro: ".concat(e.response.data.error)):alert("Error en el registro: ".concat(e.message))}else alert("Email no válido para la compañía seleccionada.")}},n.createElement("input",{type:"text",name:"username",placeholder:"Nombre de usuario",value:y.username,onChange:C}),n.createElement("input",{type:"email",name:"email",placeholder:"Email",value:y.email,onChange:C}),N(y.email)||"no"===y.company?n.createElement("div",{className:"warning-msg inactive"},"Email no válido para la compañía seleccionada."):n.createElement("div",{className:"warning-msg active"},"Email no válido para la compañía seleccionada."),n.createElement("input",{type:u?"text":"password",name:"password",placeholder:"Password",value:y.password,onChange:C}),(x=y.password,k.test(x)?n.createElement("div",{className:"warning-msg good"},"La contraseña tiene que tener entre 10 y 100 caracteres, contener al menos un número, una letra y un carácter especial."):n.createElement("div",{className:"warning-msg bad"},"La contraseña tiene que tener entre 10 y 100 caracteres, contener al menos un número, una letra y un carácter especial.")),n.createElement("button",{className:"btn",type:"button",onClick:()=>{p(!u)}},u?"Ocultar contraseña":"Mostrar contraseña"),n.createElement("div",{className:"select-element select-company"},n.createElement("select",{name:"company",value:y.company,onChange:C},n.createElement("option",{value:"no"},"No"),n.createElement("option",{value:"Google"},"Google"))),n.createElement("button",{className:"btn",type:"submit"},"Registrarse")))),n.createElement(E,null));var x};var N=a(8923),k=a(312),O=a.n(k);const C=()=>{const e=(0,r.wA)(),t=(0,o.Zp)();return()=>{const a=localStorage.getItem("authToken");if(a){const n=(0,s.s)(a),r=Date.now()/1e3;return!(n.exp<r)||(localStorage.removeItem("authToken"),t("/"),e((0,i.ri)()),!1)}return!1}},x=a(5508);O().setAppElement(".app-wrapper");const j=e=>{let{isOpen:t,handleModalClose:a,userId:o,token:l,callingComponent:s,username:m,protocolId:u,protocolTitle:p,handleSuccesfulProtocolDeletion:d}=e;const v=x.apiUrl,E=(0,r.wA)(),g=C();let f="";"Users-user"===s||"Users-admin"===s?f="usuario":"protocols"===s&&(f="protocolo");const b=()=>{localStorage.removeItem("authToken"),E((0,i.ri)())};return n.createElement(O(),{style:{content:{top:"50%",left:"50%",right:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"580px",height:"300px",backgroundColor:"#f5c6cb",color:"#8902f1",borderRadius:"8px",padding:"18px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},overlay:{backgroundColor:"rgba(1, 1, 1, 0.75)"}},onRequestClose:a,isOpen:t},n.createElement("div",{className:"modal-content"},n.createElement("h2",null,"Eliminar ".concat(f,": ").concat("protocols"===s?p:m)),n.createElement("p",null,"¿Estás seguro de que quieres eliminar este ".concat(f,"?")),n.createElement("button",{className:"btn delete-btn",onClick:"Users-user"!==s&&"Users-admin"!==s?()=>(async e=>{if(g())try{await c.A.delete("".concat(v,"/api/protocols/").concat(e)),d(e),a(),alert("Protocolo eliminado correctamente")}catch(e){alert("Error eliminando protocolo: ".concat(e.message))}})(u):()=>(async e=>{if(g())try{await c.A.delete("".concat(v,"/api/auth/delete-user/").concat(e)),a(),alert("Usuario eliminado correctamente"),"Users-user"===s&&b()}catch(e){alert("Error eliminando usuario: ".concat(e.message))}})(o)},"Borrar"),n.createElement("button",{className:"btn cancel-btn",onClick:a},"Cancelar")))};function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function S(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){A(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function A(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const q=a(5508),L=e=>{let{showFavouritesOnly:t}=e;const a=q.apiUrl,{category:i}=(0,o.g)(),s=(0,o.zy)(),m=(0,o.Zp)(),[u,f]=(0,n.useState)([]),[b,h]=(0,n.useState)(!1),[y,_]=(0,n.useState)(i),[w,k]=(0,n.useState)({}),[O,x]=(0,n.useState)(!0),[P,A]=(0,n.useState)(null),[L,D]=(0,n.useState)({id:"",title:""}),[T,I]=(0,n.useState)(null),{token:U,role:F,isAuthenticated:R}=(0,r.d4)((e=>e.auth)),z=C(),B=e=>e===y||"all-categories"===y&&"Todas las categorías"===e?"btn-active":"btn",M=e=>{A(e)},V=()=>{h(!1)},Z=e=>{!w[e]&&z()?c.A.post("".concat(a,"/api/protocols/favourite"),{protocol_id:e}).then((t=>{k((t=>S(S({},t),{},{[e]:!0})))})).catch((e=>{alert("Error marcando como favorito:",e)})):z&&c.A.delete("".concat(a,"/api/protocols/favourite"),{data:{protocol_id:e}}).then((t=>{k((t=>S(S({},t),{},{[e]:!1}))),I(e)})).catch((e=>{alert("Error eliminando de favoritos:",e)}))};(0,n.useEffect)((()=>{R&&"admin"===F&&P&&f((e=>e.filter((e=>e.id!==P))))}),[R,F,P,f]),(0,n.useEffect)((()=>{R&&t&&T&&f((e=>e.filter((e=>e.id!==T))))}),[R,T,f]);(0,n.useEffect)((()=>{const e=new URLSearchParams(s.search).get("search");(async()=>{try{const n={};e?n.search=e:y&&(n.category=y);const r=(await c.A.get("".concat(a,"/api/protocols"),{params:S(S({},n),{},{favourites:t})})).data;if(f(r),U&&r){const e={};for(const t of r)try{const n=await c.A.post("".concat(a,"/api/protocols/favourite/check"),{protocol_id:t.id});e[t.id]=n.data.isFavourite}catch(e){console.error("Error chequeando el estado de favorito del protocolo ".concat(t.id),e)}k(e)}x(!1)}catch(e){console.error("Error obteniendo protocolos",e)}})()}),[s.search,y]);return n.createElement("div",{className:"protocols-container-container container"},n.createElement(g,null),n.createElement(d,null),n.createElement("div",{className:"protocols-container-wrapper main-wrapper"},n.createElement("h2",null,"Categorías"),n.createElement("div",{className:"protocols-select-category-btns"},["Biomoléculas-DNA","Biomoléculas-Proteínas","Microbiología","Cultivos celulares","Todas las categorías"].map((e=>"Todas las categorías"!==e?n.createElement("button",{key:e,className:B(e),type:"button",onClick:t?()=>{m("/favourites/".concat(e)),_(e)}:()=>{m("/protocols/".concat(e)),_(e)}},e):n.createElement("button",{key:e,className:B(e),type:"button",onClick:t?()=>{m("/favourites/all-categories"),_("all-categories")}:()=>{m("/protocols/all-categories"),_("all-categories")}},e)))),n.createElement("div",{className:"title"},"all-categories"!==y&&y?n.createElement("h2",null,"Lista de protocolos (",y,")"):n.createElement("h2",null,"Lista de protocolos")),n.createElement(v,{onSearch:e=>{t?(_(null),m("/favourites?search=".concat(e))):(_(null),m("/protocols?search=".concat(e)))}}),R&&"admin"===F?n.createElement("div",{className:"new-protocol-icon"},n.createElement(l.N_,{className:"activity-icon",to:"/new-protocol"},n.createElement(p.g,{icon:"fa-circle-plus",size:"3x"}))):null,O?n.createElement(N.A,null):0===u.length?n.createElement("div",{className:"no-protocols-found"},"No se han encontrado protocolos que cumplan los criterios establecidos."):n.createElement("ul",{className:"protocols-list"},u.map((e=>n.createElement("li",{key:e.id,className:"protocol-wrapper"},n.createElement(j,{isOpen:b,handleModalClose:V,protocolId:L.id,protocolTitle:L.title,handleSuccesfulProtocolDeletion:M,token:U,callingComponent:"protocols"}),n.createElement("div",{className:"protocol-title"},n.createElement("h3",null,n.createElement(l.N_,{to:"/protocols/protocol/".concat(e.id)},e.title," ")),R?w[e.id]?n.createElement("div",{className:"favourite-icon"},n.createElement(p.g,{className:"empty-heart-icon activity-icon",onClick:()=>Z(e.id),icon:"fas fa-heart",size:"lg"})):n.createElement("div",{className:"favourite-icon"},n.createElement(p.g,{className:"empty-heart-icon activity-icon",onClick:()=>Z(e.id),icon:"far fa-heart",size:"lg"})):null,R&&"admin"===F?n.createElement("div",{className:"admin-activity-icons"},n.createElement("div",{className:"activity-icon"},n.createElement(l.N_,{to:"/update-protocol/".concat(e.id)},n.createElement(p.g,{icon:"fa-file-pen",size:"lg"}))),n.createElement("div",{className:"activity-icon"},n.createElement(p.g,{onClick:()=>{return t=e.id,a=e.title,D({id:t,title:a}),void h(!0);var t,a},icon:"fa-trash",size:"lg"}))):null),n.createElement("p",null,e.objective)))))),n.createElement(E,null))};var D=a(7218);function T(){const e=(0,o.zy)(),t=(0,o.Zp)(),a=(0,r.wA)(),{token:l}=(0,r.d4)((e=>e.auth));return(0,n.useEffect)((()=>{e.state&&e.state.fromRegistration?l&&(localStorage.removeItem("authToken"),a((0,i.ri)())):t("/")}),[l]),n.createElement("div",{className:"email-sent-container"},n.createElement(d,null),n.createElement("div",{className:"email-sent-page"},n.createElement("h2",null,"Email de verificación enviado"),n.createElement(p.g,{icon:"fa-envelope",size:"5x"}),n.createElement("p",null,"¡Gracias por registrarte! Se te ha enviado un email de confirmación para que puedas continuar con el proceso de registro.")),n.createElement(E,null))}const I=a(5508);function U(){const[e,t]=(0,n.useState)([]),[a,o]=(0,n.useState)(!1),[l,i]=(0,n.useState)(!0),[s,m]=(0,n.useState)({userId:"",username:""}),{token:u,username:v}=(0,r.d4)((e=>e.auth)),f=I.apiUrl,b=C();(0,n.useEffect)((()=>{u&&h()}),[u]);const h=async()=>{if(b())try{const e=(await c.A.get("".concat(f,"/api/auth/users"))).data;t(e),i(!1)}catch(e){e.response&&e.response.data&&e.response.data.error?alert("Error: ".concat(e.response.data.error)):alert("Error: ".concat(e.message)),i(!1)}},y=async(e,t)=>{if(b())try{const a=await c.A.patch("".concat(f,"/api/auth/users/update-role/").concat(e),{newRole:t});alert(a.data.message),h()}catch(e){(e=>{e.response&&e.response.data&&e.response.data.error?alert("Error: ".concat(e.response.data.error)):alert("Error: ".concat(e.message))})(e)}},_=()=>{o(!1),h()};return n.createElement("div",{className:"users-management-container"},n.createElement(g,null),n.createElement(d,null),n.createElement("div",{className:"users-list-wrapper"},n.createElement("h2",null,"Lista de usuarios"),l?n.createElement(N.A,null):n.createElement("div",{className:"users-list-users"},(e=>{const t=e.map((e=>{if(e.username!==v)return n.createElement("div",{key:e.id,className:"user-wrapper"},n.createElement(j,{isOpen:a,handleModalClose:_,userId:s.userId,username:s.username,token:u,callingComponent:"Users-admin"}),n.createElement("div",{className:"user-username"},n.createElement("span",{className:"bold"},"Nombre usuario: ")," ",e.username),n.createElement("div",{className:"user-email"},n.createElement("span",{className:"bold"},"Email: "),e.email),n.createElement("div",{className:"user-role"},n.createElement("div",{className:"select-element select-company"},n.createElement("span",{className:"bold"},"Rol: "),n.createElement("select",{name:"role",value:e.role,onChange:t=>{return a=e.id,n=t.target.value,void y(a,n);var a,n}},n.createElement("option",{value:"user"},"Usuario"),n.createElement("option",{value:"admin"},"Administrador")))),n.createElement("div",{className:"delete-icon activity-icon",onClick:()=>((e,t)=>{m({userId:e,username:t}),o(!0)})(e.id,e.username)},n.createElement(p.g,{icon:"fa-trash"})))}));return t})(e))),n.createElement(E,null))}function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){z(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function z(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const B=a(5508);function M(){const e=(0,o.Zp)(),t=(0,r.wA)(),a=B.apiUrl,l=C(),{username:m,id:u,email:p,company:v,token:f}=(0,r.d4)((e=>e.auth)),[b,h]=(0,n.useState)(!1),[y,_]=(0,n.useState)(!1),[w,N]=(0,n.useState)(!1),[k,O]=(0,n.useState)({oldPassword:"",newPassword:""}),[x,P]=(0,n.useState)({oldEmail:p,newEmail:p,company:v}),[S,A]=(0,n.useState)({newUsername:m,oldUsername:m}),q={Google:"gmail.com"},L=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*?&¿!#^])[A-Za-z\d@$!%*?&¿!#^]{10,100}$/,D=e=>{const{name:t,value:a}=e.target;O(R(R({},k),{},{[t]:a}))},T=e=>{const{name:t,value:a}=e.target;P(R(R({},x),{},{[t]:a}))};return n.createElement("div",{className:"account-management-container"},n.createElement(j,{isOpen:b,handleModalClose:()=>{h(!1)},userId:u,username:m,token:f,callingComponent:"Users-user"}),n.createElement(g,null),n.createElement(d,null),n.createElement("div",{className:"account-management-wrapper"},n.createElement("h2",{className:"title"},"Configuración de la cuenta"),n.createElement("div",{className:"email-field-wrapper"},n.createElement("h3",null,"Email"),n.createElement("input",{type:"email",name:"newEmail",placeholder:"Email",value:x.newEmail,onChange:T}),(e=>e.split("@")[1]===q[x.company])(x.newEmail)||"no"===x.company?n.createElement("div",{className:"warning-msg inactive"},"Email válido para la compañía seleccionada."):n.createElement("div",{className:"warning-msg active"},"Email no válido para la compañía seleccionada."),n.createElement("select",{name:"company",value:x.company,onChange:T},n.createElement("option",{value:"no"},"No"),n.createElement("option",{value:"Google"},"Google")),n.createElement("button",{className:"btn",type:"button",onClick:async t=>{t.preventDefault();const{oldEmail:n,newEmail:r}=x;if(n===r)alert("Error: el nuevo email y el antiguo son iguales.");else if(l())try{const t=(await c.A.patch("".concat(a,"/api/auth/update-email/").concat(u),{emailField:x})).data;alert(t.message),e("/email-sent",{state:{fromRegistration:!0}})}catch(e){e.response&&e.response.data&&e.response.data.error?alert("Error: ".concat(e.response.data.error)):alert("Error: ".concat(e.message))}}},"Confirmar cambio email")),n.createElement("div",{className:"username-field-wrapper"},n.createElement("h3",null,"Nombre de usuario"),n.createElement("input",{type:"username",name:"newUsername",placeholder:"Nombre de usuario",value:S.newUsername,onChange:e=>{const{name:t,value:a}=e.target;A(R(R({},S),{},{[t]:a}))}}),n.createElement("button",{className:"btn",type:"button",onClick:async e=>{e.preventDefault();const{newUsername:n,oldUsername:r}=S;if(n===r)alert("Error: el nuevo nombre de usuario y el antiguo son iguales.");else if(l())try{const e=(await c.A.patch("".concat(a,"/api/auth/update-username/").concat(u),{usernameField:S})).data;localStorage.setItem("authToken",e.token);const n=(0,s.s)(e.token);t((0,i.iA)({id:n.id,role:n.role,company:n.company,username:n.username,email:n.email,token:e.token})),alert(e.message),A({newUsername:n.username,oldUsername:n.username})}catch(e){e.response&&e.response.data&&e.response.data.error?alert("Error: ".concat(e.response.data.error)):alert("Error: ".concat(e.message))}}},"Confirmar cambio nombre usuario")),n.createElement("h3",null,"Contraseña"),n.createElement("div",{className:"password-wrapper old-password-wrapper"},n.createElement("input",{type:y?"text":"password",name:"oldPassword",placeholder:"Contraseña antigua",value:k.oldPassword,onChange:D}),n.createElement("button",{className:"btn",type:"button",onClick:()=>{_(!y)}},y?"Ocultar contraseña":"Mostrar contraseña")),n.createElement("div",{className:"password-wrapper new-password-wrapper"},n.createElement("input",{type:w?"text":"password",name:"newPassword",placeholder:"Nueva contraseña",value:k.newPassword,onChange:D}),(I=k.newPassword,L.test(I)?n.createElement("div",{className:"warning-msg good"},"La contraseña tiene que tener entre 10 y 100 caracteres, contener al menos un número, una letra y un carácter especial."):n.createElement("div",{className:"warning-msg bad"},"La contraseña tiene que tener entre 10 y 100 caracteres, contener al menos un número, una letra y un carácter especial.")),n.createElement("button",{className:"btn",type:"button",onClick:()=>{N(!w)}},w?"Ocultar contraseña":"Mostrar contraseña"),n.createElement("button",{className:"btn",type:"button",onClick:async e=>{e.preventDefault();const{oldPassword:t,newPassword:n}=k;if(t===n)alert("Error: la nueva contraseña y la antigua son iguales.");else if(l())try{const e=await c.A.patch("".concat(a,"/api/auth/change-password/").concat(u),{passwordField:k});O({newPassword:"",oldPassword:""});const t=e.data;alert(t.message)}catch(e){e.response&&e.response.data&&e.response.data.error?alert("Error: ".concat(e.response.data.error)):alert("Error: ".concat(e.message))}}},"Confirmar cambio contraseña"),n.createElement("div",{className:"delete-account"},n.createElement("button",{className:"btn",type:"button",onClick:()=>{h(!0)}},"Eliminar cuenta")))),n.createElement(E,null));var I}var V=a(5497);function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Z.apply(null,arguments)}const G=e=>{let{onDrop:t,previousImg:a}=e;const[r,o]=(0,n.useState)(null);(0,n.useEffect)((()=>{o(a||null)}),[a]);const l=(0,n.useCallback)((e=>{if(e&&e[0]){const a=e[0];console.log("file",a);const n=URL.createObjectURL(a);console.log("previewUrl",n),o(n),t(e)}}),[t]),{getRootProps:c,getInputProps:i}=(0,V.VB)({onDrop:l,accept:{"image/jpeg":[".jpeg",".jpg"],"image/png":[".png"]},multiple:!1,noClick:null!=r});return(0,n.useEffect)((()=>()=>{"string"==typeof r&&r.startsWith("blob:")&&URL.revokeObjectURL(r)}),[r]),n.createElement("div",Z({className:"custom-dropzone"},c(),{style:{border:"2px dashed #007bff",padding:"20px",textAlign:"center"}}),n.createElement("input",i()),r?n.createElement("div",{className:"preview-image"},n.createElement("img",{src:r,alt:"Preview"}),n.createElement("button",{className:"btn",onClick:()=>{"string"==typeof r&&r.startsWith("blob:")?URL.revokeObjectURL(r):"string"!=typeof r||r.startsWith("blob:")||URL.revokeObjectURL(r),o(null),t(null)},style:{marginTop:"10px"}},"Eliminar")):n.createElement("div",{className:"dropzone-area-empty"},n.createElement("h2",null,n.createElement(p.g,{icon:"fa-solid fa-file-image",size:"xl"})),n.createElement("h3",null,"JPG, PNG"),n.createElement("p",null,"Arrastra una imagen o pulsa para buscarla y añadirla")))},$={concentration:{molarity:{M:1,mM:1e3,µM:10**6,nM:10**9},"g/mL":{"g/mL":1,"mg/mL":1e3,"µg/mL":10**6,"ng/mL":10**9},"mg/uL":{"mg/µL":1,"µg/µL":1e3,"ng/µL":10**6},"%":{"%v/v":1,"%m/v (g/ml)":1},x:{x:1},U:{"U/µL":1}},volume:{L:1,mL:1e3,µL:10**6,nL:10**9}},H=(e,t)=>{const{concentration:a}=$;for(const n in a)if(a[n].hasOwnProperty(e)&&a[n].hasOwnProperty(t))return!0;return!1},W=(e,t,a,n)=>{const{concentration:r}=$;let o,l,c=!1,i=!1;for(const e in r)if(r[e].hasOwnProperty(t)&&(o=r[e][t],c=!0),r[e].hasOwnProperty(n)&&(l=r[e][n],i=!0),void 0!==o&&void 0!==l)break;return!(!c||!i||void 0===o||void 0===l)&&(o<l||!(o>l)&&(o===l?!(e<=a):e>a))},Y=e=>{let t;"string"!=typeof e&&(e=e.toString());const a=e.lastIndexOf(","),n=e.lastIndexOf("."),r=(e,t)=>e.split(t).length-1,o=r(e,","),l=r(e,".");o>1&&0===l?t=e.replace(/,/g,""):0===o&&l>1?t=e.replace(/\./g,""):a>n?t=e.replace(/\./g,"").replace(",","."):n>a?t=e.replace(/,/g,""):-1===a&&-1===n?t=e:-1===a?t=e.replace(/,/g,""):-1===n&&(t=e.replace(/\./g,"").replace(",","."));const c=parseFloat(t);return isNaN(c)?"":c},Q=(e,t,a)=>e*($.volume[a]/$.volume[t]);var J=a(2690);const K=a(5508),X=e=>{let{handleTextInput:t,prevText:a}=e;const[r,o]=(0,n.useState)(""),l=(0,n.useRef)(null),i=(0,n.useRef)(null),s=(0,n.useRef)(!1),m=K.apiUrl,u=C();return(0,n.useEffect)((()=>{if(!s.current){const e=new J.Ay(l.current,{theme:"snow",modules:{toolbar:{container:[[{header:"1"},{header:"2"}],[{list:"ordered"},{list:"bullet"}],["bold","italic","underline"],[{color:[]},{background:[]}],["link","image"],["clean"]],handlers:{image:()=>{const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.addEventListener("change",(()=>{const t=e.files[0];t&&v(t)}))}}}}});i.current=e,s.current=!0;const n=()=>{l.current.querySelectorAll("img").forEach((e=>{e.addEventListener("click",(()=>r(e)))}))},r=e=>{if(window.confirm("¿Quieres borrar esta imagen?")){const t=e.src;e.remove(),p(t)}},p=async e=>{try{if(200!==(await c.A.post("".concat(m,"/api/protocols/delete_protocol_img"),{img_url:e})).status)throw new Error("Error eliminando imagen del servidor");console.log("Imagen eliminada correctamente")}catch(e){console.error(e)}};a&&(e.clipboard.dangerouslyPasteHTML(a),o(a),n()),e.on("text-change",(()=>{const a=e.root.innerHTML;o(a),t(a)}));const d=async t=>{t.preventDefault(),t.stopPropagation();const a=t.dataTransfer;if(a&&a.files&&a.files.length>0){const t=a.files[0];t&&t.type.startsWith("image/")&&(e.root.querySelectorAll('img[src^="data:image"]').forEach((e=>e.remove())),v(t))}};l.current.addEventListener("drop",d);const v=async e=>{const t=i.current;let a=t.getSelection();a||(a={index:t.getLength(),length:0});try{const r=new FormData;let o;r.append("file",e),u&&(o=await c.A.post("".concat(m,"/api/protocols/upload_protocol_img"),r,{headers:{"Content-Type":"multipart/form-data"}}));const l=o.data.secure_url;console.log("imageUrl",l),t.insertEmbed(a.index,"image",l),n()}catch(e){console.error("Subida de imagen ha fallado:",e)}t.root.querySelectorAll('img[src^="data:image"]').forEach((e=>e.remove()))};return()=>{l.current&&l.current.removeEventListener("drop",d),i.current&&(i.current.off("text-change"),i.current.disable(),i.current=null,s.current=!1)}}}),[a,t]),n.createElement("div",{className:"quill-text-editor-container"},n.createElement("div",{ref:l,style:{height:"400px"}}),n.createElement("textarea",{value:r,onChange:e=>o(e.target.value),style:{display:"none"}}))};function ee(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function te(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(a),!0).forEach((function(t){ae(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ee(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ae(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const ne=a(5508);function re(e){let{mode:t}=e;const{id:a}=(0,o.g)(),r=(0,o.Zp)(),l=ne.apiUrl,i=C(),[s,m]=(0,n.useState)({title:"",category:"Biomoléculas-DNA",publication_state:"Borrador",objective:"",info:"",confidential:"no",youtube_link:""}),[u,p]=(0,n.useState)(null),[v,f]=(0,n.useState)(),[b,h]=(0,n.useState)([]),[y,_]=(0,n.useState)(!1),[w,k]=(0,n.useState)(""),[O,x]=(0,n.useState)(!0);(0,n.useEffect)((()=>{"edit"===t&&a&&i()?c.A.get("".concat(l,"/api/protocols/").concat(a)).then((e=>{m(e.data),h(e.data.reactions||[]),f(e.data.featured_image),k(e.data.info),x(!1)})).catch((e=>{alert("Error al recuperar protocolo:",e),x(!1)})):x(!1)}),[t,a]);const j=(e,t,a)=>{const n=[...b];n[e][t]=a,h(n)},P=(e,t,a,n)=>{let r=n;/\d/.test(n)&&(r=Y(n));const o=[...b];o[e].reactives[t][a]=r,h(o)},S=()=>{m({title:"",category:"Biomoléculas-DNA",publication_state:"Borrador",objective:"",info:"",confidential:"no",youtube_link:""}),h([]),p(null),_(!1)},A=Object.keys($.concentration).reduce(((e,t)=>[...e,...Object.keys($.concentration[t])]),[]),q=Object.keys($.volume),L=(0,n.useCallback)((e=>{m((t=>te(te({},t),{},{info:e})))}),[]);return n.createElement("div",{className:"protocol-form-container container"},n.createElement(d,null),O?n.createElement(N.A,null):n.createElement("div",{className:"protocol-form-wrapper main-wrapper"},n.createElement(g,null),n.createElement("h2",null,"edit"===t?"Modificar protocolo":"Nuevo protocolo"),n.createElement("form",{onSubmit:async e=>{e.preventDefault();for(let e=0;e<b.length;e++){const t=b[e];for(let a=0;a<t.reactives.length;a++){const n=t.reactives[a],{initial_concentration_value:r,initial_concentration_units:o,final_concentration_value:l,final_concentration_units:c}=n;if(!H(o,c))return void alert("Error: Las unidades de concentración inicial y final no coinciden para el reactivo ".concat(a+1," en la reacción ").concat(e+1,"."));if(!W(r,o,l,c))return void alert("Error: La concentración final debe ser menor o igual que la concentración inicial para el reactivo ".concat(a+1," en la reacción ").concat(e+1,"."))}}x(!0);const n=new FormData;n.append("title",s.title),n.append("category",s.category),n.append("publication_state",s.publication_state),n.append("objective",s.objective),n.append("info",s.info),n.append("confidential",s.confidential),n.append("youtube_link",s.youtube_link),u?n.append("featured_image",u):n.append("removeImage",y),n.append("reactions",JSON.stringify(b));try{let e;"creation"===t&&i()?(e=await c.A.post("".concat(l,"/api/protocols"),n,{headers:{"Content-Type":"multipart/form-data"}}),201!==e.status&&200!==e.status||(alert("Protocolo creado"),r("/protocols/all-categories"),x(!1))):"edit"===t&&i()&&(e=await c.A.put("".concat(l,"/api/protocols/").concat(a),n,{headers:{"Content-Type":"multipart/form-data"}}),201!==e.status&&200!==e.status||(alert("Protocolo actualizado"),r("/protocols/protocol/".concat(e.data.id)),x(!1))),S()}catch(e){console.error("Error Details:",e),alert("Error al enviar el formulario:",e.message)}}},n.createElement("div",{className:"protocol-title"},n.createElement("h4",null,"Título"),n.createElement("input",{placeholder:"Título",type:"text",value:s.title,onChange:e=>m(te(te({},s),{},{title:e.target.value})),required:!0})),n.createElement("div",{className:"protocol-category"},n.createElement("h4",null,"Categoría"),n.createElement("select",{name:"category",value:s.category,onChange:e=>m(te(te({},s),{},{category:e.target.value}))},n.createElement("option",{value:"Biomoléculas-DNA"},"Biomoléculas-DNA"),n.createElement("option",{value:"Biomoléculas-Proteínas"},"Biomoléculas-Proteínas"),n.createElement("option",{value:"Microbiología"},"Microbiología"),n.createElement("option",{value:"Cultivos celulares"},"Cultivos celulares"))),n.createElement("div",{className:"protocol-publication-state"},n.createElement("h4",null,"Estado de publicación:"),n.createElement("select",{name:"publication_state",value:s.publication_state,onChange:e=>m(te(te({},s),{},{publication_state:e.target.value}))},n.createElement("option",{value:"Borrador"},"Borrador"),n.createElement("option",{value:"Publicado"},"Publicado"))),n.createElement("div",{className:"protocol-objective"},n.createElement("h4",null,"Objetivo"),n.createElement("input",{placeholder:"Objetivo",type:"text",value:s.objective,onChange:e=>m(te(te({},s),{},{objective:e.target.value})),required:!0})),n.createElement("div",{className:"protocol-info"},n.createElement("h4",null,"Texto"),n.createElement(X,{handleTextInput:L,prevText:"edit"===t?w:""})),n.createElement("div",{className:"protocol-featured-img"},n.createElement("h4",null,"Imagen de portada:"),n.createElement("div",{className:"featured-img-uploader"},n.createElement(G,{onDrop:e=>{e&&e.length>0?p(e[0]):(p(null),_(!0))},previousImg:v}))),n.createElement("div",{className:"protocol-confidential"},n.createElement("h4",null,"Confidencialidad:"),n.createElement("select",{name:"confidential",value:s.confidential,onChange:e=>m(te(te({},s),{},{confidential:e.target.value}))},n.createElement("option",{value:"no"},"No"),n.createElement("option",{value:"Google"},"Google"))),n.createElement("div",{className:"protocol-youtube-link"},n.createElement("h4",null,"Link youtube:"),n.createElement("input",{placeholder:"YouTube Link",type:"text",value:s.youtube_link,onChange:e=>m(te(te({},s),{},{youtube_link:e.target.value}))})),n.createElement("div",{className:"protocol-reactions"},n.createElement("h4",null,"Reacciones"),b.map(((e,t)=>n.createElement("div",{key:t,className:"reaction"},n.createElement("h5",null,"Reacción ",t+1),n.createElement("input",{placeholder:"Nombre de la reacción",type:"text",value:e.title,onChange:e=>j(t,"title",e.target.value),required:!0}),e.reactives.map(((e,a)=>n.createElement("div",{key:a,className:"reactive"},n.createElement("h6",null,"Reactivo ",a+1),n.createElement("input",{placeholder:"Nombre",type:"text",value:e.name,onChange:e=>P(t,a,"name",e.target.value),required:!0}),n.createElement("input",{placeholder:"Concentración inicial (valor)",type:"number",step:"0.01",value:e.initial_concentration_value,onChange:e=>P(t,a,"initial_concentration_value",e.target.value),required:!0}),n.createElement("select",{value:e.initial_concentration_units,onChange:e=>P(t,a,"initial_concentration_units",e.target.value),required:!0},n.createElement("option",{value:""},"Concentración inicial (unidades)"),A.map(((e,t)=>n.createElement("option",{key:t,value:e},e)))),n.createElement("input",{placeholder:"Concentración final (valor)",type:"number",step:"0.01",value:e.final_concentration_value,onChange:e=>P(t,a,"final_concentration_value",e.target.value),required:!0}),n.createElement("select",{value:e.final_concentration_units,onChange:e=>P(t,a,"final_concentration_units",e.target.value),required:!0},n.createElement("option",{value:""},"Concentración final (unidades)"),A.map(((e,t)=>n.createElement("option",{key:t,value:e},e)))),n.createElement("button",{className:"btn",type:"button",onClick:()=>((e,t)=>{const a=[...b];a[e].reactives=a[e].reactives.filter(((e,a)=>a!==t)),h(a)})(t,a)},"Eliminar Reactivo")))),n.createElement("button",{className:"btn",type:"button",onClick:()=>(e=>{const t=[...b];t[e].reactives.push({name:"",initial_concentration_value:"",initial_concentration_units:"",final_concentration_value:"",final_concentration_units:""}),h(t)})(t)},"Añadir Reactivo"),n.createElement("input",{placeholder:"Volumen total reacción (valor)",type:"number",step:"0.01",value:e.reaction_volume_value,onChange:e=>j(t,"reaction_volume_value",e.target.value),required:!0}),n.createElement("select",{value:e.reaction_volume_units,onChange:e=>j(t,"reaction_volume_units",e.target.value),required:!0},n.createElement("option",{value:""},"Volumen total reacción (unidades)"),q.map(((e,t)=>n.createElement("option",{key:t,value:e},e)))),n.createElement("input",{placeholder:"Solvente de la reacción",type:"text",value:e.solvent,onChange:e=>j(t,"solvent",e.target.value),required:!0}),n.createElement("button",{className:"btn",type:"button",onClick:()=>(e=>{const t=b.filter(((t,a)=>a!==e));h(t)})(t)},"Eliminar Reacción")))),n.createElement("button",{className:"btn",type:"button",onClick:()=>{h([...b,{title:"",reactives:[{name:"",initial_concentration_value:"",initial_concentration_units:"",final_concentration_value:"",final_concentration_units:""}],reaction_volume_value:"",reaction_volume_units:"",solvent:""}])}},"Añadir reacción")),n.createElement("button",{className:"btn",type:"submit"},"creation"===t?"Crear protocolo":"Actualizar protocolo"))),n.createElement(E,null))}var oe=a(7240);function le(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?le(Object(a),!0).forEach((function(t){ie(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):le(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ie(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const se=a(5508),me=()=>{const e=(0,n.useRef)(),[t,a]=(0,n.useState)([]),l=((e,t)=>(0,oe.useReactToPrint)({content:()=>e.current,onBeforeGetContent:()=>new Promise((a=>{t.forEach((t=>{const a=e.current.querySelectorAll(t);a.length>0&&a.forEach((e=>e.style.setProperty("display","none","important")))})),setTimeout((()=>a()),500)})),onAfterPrint:()=>{t.forEach((t=>{const a=e.current.querySelectorAll(t);a.length>0&&a.forEach((e=>e.style.display=""))}))}}))(e,t),{id:i}=(0,o.g)(),s=(0,o.Zp)(),[m,u]=(0,n.useState)(null),v=se.apiUrl,[f,b]=(0,n.useState)([{title:"",reactives:[{name:"",initial_concentration_value:0,initial_concentration_units:"",final_concentration_value:0,final_concentration_units:"",eliminate_from_mix:!1,reactive_volume_value:0,reactive_volume_units:""}],reaction_volume_value:0,reaction_volume_units:"",solvent:"",solvent_volume_value:0,solvent_volume_units:"",premix_volume_value:0,premix_volume_units:"",extra_percent:10,number_samples:1}]),[h,y]=(0,n.useState)(!0),[_,w]=(0,n.useState)(!1),[k,O]=(0,n.useState)(!1),[x,P]=(0,n.useState)(!1),{token:S,role:A,isAuthenticated:q}=(0,r.d4)((e=>e.auth)),L=C(),D=Object.keys($.concentration).reduce(((e,t)=>[...e,...Object.keys($.concentration[t])]),[]),T=Object.keys($.volume);(0,n.useEffect)((()=>{c.A.get("".concat(v,"/api/protocols/").concat(i)).then((e=>{u(e.data);const t=I(e.data.reactions);b(t),S&&q&&L()&&c.A.post("".concat(v,"/api/protocols/favourite/check"),{protocol_id:e.data.id}).then((e=>{O(e.data.isFavourite)})),y(!1)})).catch((e=>{alert("Error obteniendo protocolo:",e),s("/protocols")}))}),[i]);const I=e=>e.map((e=>ce(ce(ce({},f[0]),e),{},{solvent_volume_units:e.reaction_volume_units,premix_volume_units:e.reaction_volume_units,reactives:e.reactives.map((t=>ce(ce(ce({},f[0].reactives[0]),t),{},{reactive_volume_units:e.reaction_volume_units})))}))).map((e=>U(e))),U=e=>{const t=e.reactives.map((t=>{const a=z(e.extra_percent,e.number_samples,e.reaction_volume_value,e.reaction_volume_units,t.initial_concentration_value,t.initial_concentration_units,t.final_concentration_value,t.final_concentration_units),n=Q(a,e.reaction_volume_units,t.reactive_volume_units);return ce(ce({},t),{},{reactive_volume_value:parseFloat(n.toFixed(3))})})),a=t.reduce(((t,a)=>t+Q(a.reactive_volume_value||0,a.reactive_volume_units,e.reaction_volume_units)),0),n=Q(e.reaction_volume_value*(e.extra_percent+100)/100*e.number_samples-a,e.reaction_volume_units,e.solvent_volume_units),r=t.reduce(((t,a)=>a.eliminate_from_mix?t+Q(a.reactive_volume_value||0,a.reactive_volume_units,e.reaction_volume_units):t),0),o=Q((a+n-r)/(e.number_samples*(e.extra_percent+100)/100),e.reaction_volume_units,e.premix_volume_units);return ce(ce({},e),{},{reactives:t,solvent_volume_value:parseFloat(n.toFixed(3)),premix_volume_value:parseFloat(o.toFixed(3))})},F=(e,t,a,n)=>{b((r=>r.map(((r,o)=>{if(o!==e)return r;let l=ce({},r);if(null===t)if("reaction_volume_units"===a){const e=Q(r.reaction_volume_value,r.reaction_volume_units,n);l=ce(ce({},r),{},{reaction_volume_value:parseFloat(e.toFixed(3)),[a]:n})}else if("solvent_volume_units"===a){const e=Q(r.solvent_volume_value,r.solvent_volume_units,n);l=ce(ce({},r),{},{solvent_volume_value:parseFloat(e.toFixed(3)),[a]:n})}else if("premix_volume_units"===a){const e=Q(r.premix_volume_value,r.premix_volume_units,n);l=ce(ce({},r),{},{premix_volume_value:parseFloat(e.toFixed(3)),[a]:n})}else l=ce(ce({},r),{},{[a]:n});else l=ce(ce({},r),{},{reactives:r.reactives.map(((e,r)=>{if(r===t){if("reactive_volume_units"===a){const t=Q(e.reactive_volume_value,e.reactive_volume_units,n);return ce(ce({},e),{},{reactive_volume_value:parseFloat(t.toFixed(3)),[a]:n})}return ce(ce({},e),{},{[a]:n})}return e}))});return U(l)}))))},R=e=>{!k&&L()?c.A.post("".concat(v,"/api/protocols/favourite"),{protocol_id:e}).then((e=>{O(!0)})).catch((e=>{alert("Error marcando como favorito:",e)})):L()&&c.A.delete("".concat(v,"/api/protocols/favourite"),{data:{protocol_id:e}}).then((e=>{O(!1)})).catch((e=>{alert("Error eliminando de favoritos:",e)}))},z=(e,t,a,n,r,o,l,c)=>{const i=Y(e),s=Y(t),m=Y(r),u=Y(l),p=Y(a);if(H(o,c)&&W(m,o,u,c)){const{reactiveVolumeValue:e}=((e,t,a,n,r,o)=>{if(W(a,n,r,o)){const{concentration:l}=$;let c,i;for(const e in l)l[e].hasOwnProperty(n)&&(c=l[e][n]),l[e].hasOwnProperty(o)&&(i=l[e][o]);return{reactiveVolumeValue:r*e*(c/i)/a,reactiveVolumeUnits:t}}return new Error("El cálculo no se puede realizar, comprueba las unidades y los valores. Una concentración final no puede estar más concentrada que una inicial.")})(p,n,m,o,u,c);return e*s*((100+i)/100)}return 0},B=(e,t,a,r,o)=>n.createElement(n.Fragment,{key:r},n.createElement("div",{className:"grid-row"},n.createElement("input",{className:"reactive-name",type:"text",value:a.name,onChange:e=>F(t,r,"name",e.target.value)}),n.createElement("input",{type:"number",value:0!==a.reactive_volume_value?o?parseFloat((a.reactive_volume_value/((e[t].extra_percent+100)*e[t].number_samples/100)).toFixed(3)):a.reactive_volume_value:"",readOnly:!0}),n.createElement("select",{value:a.reactive_volume_units,onChange:e=>F(t,r,"reactive_volume_units",e.target.value)},T.map(((e,t)=>n.createElement("option",{key:t,value:e},e)))),n.createElement("input",{type:"number",step:"0.01",value:a.initial_concentration_value,onChange:e=>F(t,r,"initial_concentration_value",Y(e.target.value))}),n.createElement("select",{value:a.initial_concentration_units,onChange:e=>F(t,r,"initial_concentration_units",e.target.value)},D.map(((e,t)=>n.createElement("option",{key:t,value:e},e)))),n.createElement("input",{type:"number",step:"0.01",value:a.final_concentration_value,onChange:e=>F(t,r,"final_concentration_value",Y(e.target.value))}),n.createElement("select",{value:a.final_concentration_units,onChange:e=>F(t,r,"final_concentration_units",e.target.value)},D.map(((e,t)=>n.createElement("option",{key:t,value:e},e))))),n.createElement("div",{className:"grid-row-btns"},n.createElement("button",{className:"btn",onClick:()=>((e,t)=>{b((a=>a.map(((a,n)=>{if(n!==e)return a;const r=a.reactives.map(((e,a)=>a===t?ce(ce({},e),{},{eliminate_from_mix:!e.eliminate_from_mix}):e)),o=ce(ce({},a),{},{reactives:r});return U(o)}))))})(t,r)},a.eliminate_from_mix?"Añadir al premix":"Quitar del premix"),n.createElement("button",{className:"btn",onClick:()=>((e,t,a)=>{const n=[...e],r=n[t],o=r.reactives[a],l=o.reactive_volume_value,c=o.reactive_volume_units;n[t].reactives=n[t].reactives.filter(((e,t)=>t!==a)),n[t]=ce(ce({},r),{},{solvent_volume_value:parseFloat((r.solvent_volume_value+Q(l,c,r.solvent_volume_units)).toFixed(3))}),b(n)})(e,t,r)},"Quitar de la reacción"))),M=e=>{let t=[".btn",".navbar-wrapper",".youtube-video-wrapper",".protocol-featured-image",".download-wrapper"];"pdf-complete"===e?a([...t]):"pdf-protocol"===e?a([...t,".calculation-to-download"]):"pdf-reactions"===e&&a([...t,".protocol-to-download"]),P(!0)};return(0,n.useEffect)((()=>{x&&(l(),P(!1))}),[x,l]),n.createElement("div",{ref:e,className:"protocol-container container"},n.createElement(d,null),!h&&m?n.createElement("div",{className:"protocol-wrapper main-wrapper protocol-complete-to-download"},n.createElement(j,{isOpen:_,handleModalClose:()=>{w(!1)},protocolId:m.id,protocolTitle:m.title,handleSuccesfulProtocolDeletion:()=>{s("/protocols")},token:S,callingComponent:"protocols"}),n.createElement(g,null),n.createElement("div",{className:"protocol-top-wrapper protocol-to-download"},n.createElement("div",{className:"protocol-title-wrapper"},n.createElement("div",{className:"protocol-title"},n.createElement("h2",null,m.title)),n.createElement("div",{className:"protocol-activity-icons-wrapper"},"admin"===A?n.createElement("h4",null,m.publication_state):null,n.createElement("div",{className:"protocol-action-elements"},q&&"admin"===A?n.createElement("div",{className:"admin-icons"},n.createElement(p.g,{className:"edition-icon activity-icon",onClick:()=>(e=>{s("/update-protocol/".concat(e))})(m.id),icon:"fa-file-pen",size:"lg"}),n.createElement(p.g,{className:"delete-icon activity-icon",onClick:()=>{w(!0)},icon:"fa-trash",size:"lg"})):null)))),m.featured_image&&n.createElement("div",{className:"protocol-featured-image"},n.createElement("img",{src:m.featured_image,alt:"Featured-img"})),n.createElement("div",{className:"download-wrapper"},q?k?n.createElement(p.g,{className:"empty-heart-icon activity-icon favourite-icon",onClick:()=>R(m.id),icon:"fas fa-heart",size:"lg"}):n.createElement(p.g,{className:"empty-heart-icon activity-icon favourite-icon",onClick:()=>R(m.id),icon:"far fa-heart",size:"lg"}):null,n.createElement("div",{className:"download-icon activity-icon",onClick:()=>M("pdf-complete")},n.createElement(p.g,{icon:"fa-file-pdf",size:"lg"})," Completo"),n.createElement("div",{className:"download-icon activity-icon",onClick:()=>M("pdf-protocol")},n.createElement(p.g,{icon:"fa-file-pdf",size:"lg"})," Protocolo"),n.createElement("div",{className:"download-icon activity-icon",onClick:()=>M("pdf-reactions")},n.createElement(p.g,{icon:"fa-file-pdf",size:"lg"})," Cálculos")),n.createElement("div",{className:"protocol-objective protocol-to-download"},n.createElement("h3",null,"Objetivo"),n.createElement("p",null,m.objective)),n.createElement("div",{className:"protocol-info protocol-to-download"},n.createElement("h3",null,"Procedimiento experimental"),n.createElement("div",{className:"protocol-info-text ql-editor",dangerouslySetInnerHTML:{__html:m.info}})),0!==f.length?n.createElement("div",{className:"protocol-reactions calculation-to-download"},n.createElement("h4",null,"Reacciones"),f.map(((e,t)=>{const a=e.reactives.filter((e=>!0===e.eliminate_from_mix));return n.createElement("div",{key:t,className:"reaction"},n.createElement("h5",null,e.title),n.createElement("div",{className:"reaction-header-wrapper"},n.createElement("div",{className:"extra-percent-wrapper"},n.createElement("h5",null,"Porcentaje extra (%)"),n.createElement("input",{type:"number",step:"1",value:e.extra_percent,onChange:e=>F(t,null,"extra_percent",Y(e.target.value))})),n.createElement("div",{className:"reaction-volume-wrapper"},n.createElement("h5",null,"Volumen de reacción"),n.createElement("input",{type:"number",step:"0.01",value:e.reaction_volume_value,onChange:e=>F(t,null,"reaction_volume_value",Y(e.target.value))}),n.createElement("select",{value:e.reaction_volume_units,onChange:e=>F(t,null,"reaction_volume_units",e.target.value)},T.map(((e,t)=>n.createElement("option",{key:t,value:e},e))))),n.createElement("div",{className:"number-samples"},n.createElement("h5",null,"Número de muestras"),n.createElement("input",{type:"number",value:e.number_samples,onChange:e=>F(t,null,"number_samples",Y(e.target.value))}))),n.createElement("h4",null,"Reactivos incluidos en el premix"),n.createElement("span",{className:"small-note"},"Nota: si un volumen de reactivo desaparece, revisa sus unidades"),n.createElement("div",{className:"reaction-table-container"},n.createElement("div",{className:"reaction-table reaction-table-inside-mix"},n.createElement("div",{className:"grid-header"},n.createElement("div",null,"Reactivo"),n.createElement("div",null,"Volumen"),n.createElement("div",null,"Concentración Inicial"),n.createElement("div",null,"Concentración Final")),e.reactives.map(((e,a)=>e.eliminate_from_mix?null:B(f,t,e,a,e.eliminate_from_mix))),n.createElement("div",{className:"grid-row"},n.createElement("input",{type:"text",value:e.solvent,onChange:e=>F(t,null,"name",e.target.value)}),n.createElement("input",{type:"number",value:e.solvent_volume_value,readOnly:!0}),n.createElement("select",{value:e.solvent_volume_units,onChange:e=>F(t,null,"solvent_volume_units",e.target.value)},T.map(((e,t)=>n.createElement("option",{key:t,value:e},e))))),n.createElement("button",{className:"btn",onClick:()=>((e,t)=>{const a=[...e],n=a[t];a[t].reactives.push({name:"Nuevo reactivo",initial_concentration_value:0,initial_concentration_units:"M",final_concentration_value:0,final_concentration_units:"M",eliminate_from_mix:!1,reactive_volume_value:0,reactive_volume_units:n.reaction_volume_units||"nL"}),b(a)})(f,t),style:{marginTop:"20px"}},"Añadir nuevo reactivo"))),a.length>0?n.createElement("div",{className:"excluded-reactions-table-container"},n.createElement("div",{key:"premix-".concat(t)},n.createElement("h4",null,"Volumen de premix por muestra"),n.createElement("input",{type:"number",value:e.premix_volume_value,readOnly:!0}),n.createElement("select",{value:e.premix_volume_units,onChange:e=>F(t,null,"premix_volume_units",e.target.value)},T.map(((e,t)=>n.createElement("option",{key:t,value:e},e))))),n.createElement("h4",null,"Reactivos excluidos del mix (añadir por separado)"),n.createElement("div",{className:"reaction-table-container"},n.createElement("div",{className:"reaction-table reaction-table-outside-mix"},n.createElement("div",{className:"grid-header"},n.createElement("div",null,"Reactivo"),n.createElement("div",null,"Volumen"),n.createElement("div",null,"Concentración Inicial"),n.createElement("div",null,"Concentración Final")),e.reactives.map(((e,a)=>e.eliminate_from_mix?B(f,t,e,a,e.eliminate_from_mix):null))))):null)}))):null,m.youtube_link?n.createElement("div",{className:"youtube-video-wrapper"},n.createElement("div",{className:"youtube-video-title"},n.createElement("h4",null,"Vídeo explicativo")),n.createElement("div",{className:"youtube-video-text"},"Vídeo en el que se explica la teoría relacionada con el procedimiento experimental."),n.createElement("div",{className:"youtube-video-embeded-video"},n.createElement("iframe",{width:"560",height:"315",src:(e=>{const t=e.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return t?"https://www.youtube.com/embed/".concat(t[1]):null})(m.youtube_link),title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0}))):null):n.createElement(N.A,null),n.createElement(E,null))},ue=()=>{const e=(0,r.wA)(),[t,a]=(0,n.useState)(!0),{role:m,isAuthenticated:p,authLoading:d}=(0,r.d4)((e=>e.auth));(0,D.A)(),c.A.interceptors.request.use((async e=>{const t=localStorage.getItem("authToken");if(t){const a=(0,s.s)(t),n=Date.now()/1e3;if(a.exp<n)return localStorage.removeItem("authToken"),store.dispatch((0,i.ri)()),Promise.reject("Token expirado. Por favor, inicia sesión de nuevo.");e.headers.Authorization="Bearer ".concat(t)}return e}),(e=>Promise.reject(e))),(0,n.useEffect)((()=>{(async()=>{try{if(await(async()=>!!await u())()){const{userInfo:t,token:a}=await u();t&&a&&e((0,i.iA)({id:t.id,role:t.role,company:t.company,username:t.username,email:t.email,token:a}))}else e({type:"FINISH_AUTH_LOADING"})}catch(e){console.error("Error initializing auth:",e)}finally{a(!1)}})()}),[e]);const v=t||d;return n.createElement(l.Kd,null,n.createElement(o.BV,null,v?n.createElement(o.qh,{key:"loading",path:"*",element:n.createElement(N.A,null)}):((e,t,a)=>{const r=[n.createElement(o.qh,{key:"home",path:"/",element:n.createElement(f,null)}),n.createElement(o.qh,{key:"protocols-category",path:"/protocols/:category",element:n.createElement(L,null)}),n.createElement(o.qh,{key:"protocols-search",path:"/protocols",element:n.createElement(L,null)}),n.createElement(o.qh,{key:"protocols-protocol",path:"/protocols/protocol/:id",element:n.createElement(me,null)}),n.createElement(o.qh,{key:"email-sent",path:"/email-sent",element:n.createElement(T,null)})],l=[n.createElement(o.qh,{key:"login",path:"/login",element:n.createElement(w,null)})],c=[n.createElement(o.qh,{key:"favourites-category",path:"/favourites/:category",element:n.createElement(L,{key:"favourites-search-".concat(location.pathname),showFavouritesOnly:!0})}),n.createElement(o.qh,{key:"favourites-search",path:"/favourites",element:n.createElement(L,{key:"favourites-search-".concat(location.pathname),showFavouritesOnly:!0})}),n.createElement(o.qh,{key:"account-management",path:"/account-management",element:n.createElement(M,null)})],i=[n.createElement(o.qh,{key:"users-management",path:"/users-management",element:n.createElement(U,null)}),n.createElement(o.qh,{key:"protocol-creation",path:"/new-protocol",element:n.createElement(re,{mode:"creation"})}),n.createElement(o.qh,{key:"protocol-update",path:"/update-protocol/:id",element:n.createElement(re,{mode:"edit"})})],s=[n.createElement(o.qh,{key:"not-found",path:"*",element:n.createElement(o.C5,{to:"/",replace:!0})})];if(!a)return t?t&&"admin"===e?[...r,...c,...i,...s]:t&&"user"===e?[...r,...c,...s]:[...l,...r,...s]:[...r,...l,...s]})(m,p,v)))}}}]);
//# sourceMappingURL=787-5dacc298693d115df024.js.map